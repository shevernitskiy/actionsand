# This is a basic workflow to help you get started with Actions

name: SP Release


on:
  workflow_dispatch:

jobs:
  filework:
    runs-on: ubuntu-latest

    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
      # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
      - uses: actions/checkout@v2
      # Runs a set of commands using the runners shell
      - name: Generate changelog
        run: |
          OLDVER=$(sed -n "s/.*\([0-9]\.[0-9]\.[0-9]*\).*/\1/p" ${{github.workspace}}/content/replaces/testreaplce.txt | head -1)
          MINOR=$(echo "$OLDVER" | sed -n "s/[0-9]\.\([0-9]\)\.[0-9]/\1/p")
          NEWMINOR=$((MINOR+1))
          NEWVER=$(echo "$OLDVER" | sed -n "s/\.$MINOR\./\.$NEWMINOR\./p")
          echo "OLDVER=$OLDVER" >> $GITHUB_ENV
          echo "NEWVER=$NEWVER" >> $GITHUB_ENV
          echo "# SP $newver Release Notes"$'\n'"bla bla bla"$'\n' >> "sp-$NEWVER.md"
          for file in `find "${{github.workspace}}/content/dev" -type f -name "sp*.md"`
          do
            content=$(< $file)
            echo "$content" >> "sp-$NEWVER.md"
            echo $'\n' >> "sp-$NEWVER.md"
          done
          cat "sp-$NEWVER.md"

      - name: Replace version number
        run: |
          sed -i "s/${{ env.OLDVER }}/${{ env.NEWVER }}/g" ${{github.workspace}}/content/replaces/testreaplce.txt

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v3
        with:
          commit-message: "Update SP to ${{ env.NEWVER }}"
          title: "release(skyrim-platform): version ${{ env.NEWVER }}"
          body: Test message
          branch: release-branch
